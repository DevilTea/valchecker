# shared.spec.md

Source File: `./shared.ts`

## Functionality Summary
- This file contains shared TypeScript types and utility functions/classes used across the valchecker library, including type utilities for conditional types, object creation helpers with prototype pollution protection, error handling utilities, and a promise-like execution chain for managing synchronous and asynchronous values.

## Exported Items (Functions, Classes, Constants, TS Types, etc.)
- `AnyFn`
  - Description: A type representing any function that accepts any number of arguments and returns any value
  - Input: N/A (type definition)
  - Output: N/A (type definition)
- `Simplify<T>`
  - Description: A utility type that simplifies complex intersection types by flattening them into a single object type
  - Input: A generic type T
  - Output: A simplified version of T
- `Optional<T>`
  - Description: A type that makes a type optional by unioning it with undefined
  - Input: A generic type T
  - Output: T | undefined
- `IsAllPropsOptional<T>`
  - Description: A conditional type that checks if all properties of an object type are optional
  - Input: An object type T
  - Output: true if all properties are optional, false otherwise
- `Equal<X, Y>`
  - Description: A type that checks if two types X and Y are structurally equal
  - Input: Two generic types X and Y
  - Output: true if X and Y are equal, false otherwise
- `MaybePromise<T>`
  - Description: A type that represents either a value or a promise of that value
  - Input: A generic type T
  - Output: T | Promise<T>
- `IsReturnPromise<Fn>`
  - Description: A conditional type that checks if a function's return type is a promise
  - Input: A function type Fn
  - Output: true if the function returns a promise, false otherwise, or boolean for ambiguous cases
- `NullProtoObj`
  - Description: A constructor function that creates objects with null prototype to prevent prototype pollution
  - Input: N/A (constructor)
  - Output: A new object with null prototype
- `safeAssign`
  - Description: Safely assigns properties from source objects to a target object, excluding potentially dangerous properties that could cause prototype pollution
  - Input: target (Record<any, any>), ...sources (Record<any, any>[])
  - Output: The target object with safe properties assigned
- `createObject<T>`
  - Description: Creates a new object with null prototype and assigns properties from the input object, excluding potentially dangerous properties
  - Input: An optional object obj of type T
  - Output: A new object of type T with null prototype
- `throwNotImplementedError`
  - Description: Throws an error indicating that a method is not implemented
  - Input: None
  - Output: Never returns (throws error)
- `expectNever`
  - Description: Throws an error when a value is unexpectedly received in a never-expected context
  - Input: An optional value of type never
  - Output: Never returns (throws error)
- `returnTrue`
  - Description: Returns the boolean value true
  - Input: None
  - Output: true
- `returnFalse`
  - Description: Returns the boolean value false
  - Input: None
  - Output: false
- `ExecutionChain<T>`
  - Description: A class that implements PromiseLike and manages execution chains for both synchronous and asynchronous values
  - Input: Constructor accepts either a value or an error
  - Output: An instance that can be chained with .then() and has a .value getter
- `createExecutionChain`
  - Description: Factory function to create ExecutionChain instances
  - Input: Optional value of any type
  - Output: A new ExecutionChain instance

## Test Cases (as strictly required for 100% coverage)
- `AnyFn`
  - Happy Path Cases
    - [ ] case 1: Type can be assigned to various function signatures
      - Input: N/A (type usage)
      - Expected: Type assignment succeeds
- `Simplify<T>`
  - Happy Path Cases
    - [ ] case 1: Simplifies intersection types
      - Input: { a: string } & { b: number }
      - Expected: { a: string; b: number }
- `Optional<T>`
  - Happy Path Cases
    - [ ] case 1: Makes type optional
      - Input: string
      - Expected: string | undefined
- `IsAllPropsOptional<T>`
  - Happy Path Cases
    - [ ] case 1: All properties optional
      - Input: { a?: string; b?: number }
      - Expected: true
    - [ ] case 2: Not all properties optional
      - Input: { a: string; b?: number }
      - Expected: false
- `Equal<X, Y>`
  - Happy Path Cases
    - [ ] case 1: Types are equal
      - Input: string, string
      - Expected: true
    - [ ] case 2: Types are not equal
      - Input: string, number
      - Expected: false
- `MaybePromise<T>`
  - Happy Path Cases
    - [ ] case 1: Resolves to value type
      - Input: string
      - Expected: string | Promise<string>
- `IsReturnPromise<Fn>`
  - Happy Path Cases
    - [ ] case 1: Function returns promise
      - Input: () => Promise<string>
      - Expected: true
    - [ ] case 2: Function returns non-promise
      - Input: () => string
      - Expected: false
- `NullProtoObj`
  - Happy Path Cases
    - [ ] case 1: Creates object with null prototype
      - Input: N/A
      - Expected: Object with null prototype
- `safeAssign`
  - Happy Path Cases
    - [ ] case 1: Assigns safe properties from single source
      - Input: target: {}, source: { a: 1, b: 2 }
      - Expected: target with a: 1, b: 2
    - [ ] case 2: Assigns safe properties from multiple sources
      - Input: target: {}, sources: [{ a: 1 }, { b: 2 }]
      - Expected: target with a: 1, b: 2
    - [ ] case 3: Skips non-object sources
      - Input: target: {}, sources: [{ a: 1 }, 'string', null]
      - Expected: target with a: 1
  - Edge Cases
    - [ ] case 1: Excludes dangerous properties (__proto__)
      - Input: target: {}, source: { a: 1, __proto__: { polluted: true } }
      - Expected: target with a: 1, __proto__ excluded
    - [ ] case 2: Excludes dangerous properties (constructor)
      - Input: target: {}, source: { a: 1, constructor: () => {} }
      - Expected: target with a: 1, constructor excluded
    - [ ] case 3: Excludes dangerous properties (prototype)
      - Input: target: {}, source: { a: 1, prototype: {} }
      - Expected: target with a: 1, prototype excluded
- `createObject<T>`
  - Happy Path Cases
    - [ ] case 1: Creates object with properties
      - Input: { a: 1, b: 2 }
      - Expected: Object with a: 1, b: 2 and null prototype
    - [ ] case 2: Creates empty object
      - Input: undefined
      - Expected: Empty object with null prototype
  - Edge Cases
    - [ ] case 1: Excludes dangerous properties
      - Input: { __proto__: {}, constructor: () => {}, prototype: {} }
      - Expected: Empty object (dangerous properties excluded)
- `throwNotImplementedError`
  - Error Cases
    - [ ] case 1: Always throws error
      - Input: None
      - Expected: Throws Error with message 'Method not implemented.'
- `expectNever`
  - Error Cases
    - [ ] case 1: Throws with provided value
      - Input: 'unexpected'
      - Expected: Throws Error with message containing 'unexpected'
    - [ ] case 2: Throws with undefined
      - Input: undefined
      - Expected: Throws Error with message containing 'undefined'
- `returnTrue`
  - Happy Path Cases
    - [ ] case 1: Returns true
      - Input: None
      - Expected: true
- `returnFalse`
  - Happy Path Cases
    - [ ] case 1: Returns false
      - Input: None
      - Expected: false
- `ExecutionChain<T>`
  - Happy Path Cases
    - [ ] case 1: Constructor with sync value
      - Input: 'test'
      - Expected: ExecutionChain with value 'test'
    - [ ] case 2: Constructor with promise value
      - Input: Promise.resolve('test')
      - Expected: ExecutionChain with promise value
    - [ ] case 3: Constructor with sync error
      - Input: undefined, new Error('test')
      - Expected: ExecutionChain with sync error
    - [ ] case 4: Constructor with another ExecutionChain
      - Input: existing ExecutionChain
      - Expected: ExecutionChain with same internal data
    - [ ] case 5: then() with sync value and onfulfilled
      - Input: ExecutionChain('test'), (v) => v.toUpperCase()
      - Expected: ExecutionChain with 'TEST'
    - [ ] case 6: then() with sync value and onrejected (no error)
      - Input: ExecutionChain('test'), null, (e) => 'error'
      - Expected: Same ExecutionChain
    - [ ] case 7: then() with sync error and onrejected
      - Input: ExecutionChain with error, null, (e) => 'handled'
      - Expected: ExecutionChain with 'handled'
    - [ ] case 8: then() with promise value
      - Input: ExecutionChain(Promise.resolve('test')), (v) => v.toUpperCase()
      - Expected: ExecutionChain with promise of 'TEST'
    - [ ] case 9: value getter with sync value
      - Input: ExecutionChain('test')
      - Expected: 'test'
    - [ ] case 10: value getter with promise value
      - Input: ExecutionChain(Promise.resolve('test'))
      - Expected: Promise<'test'>
    - [ ] case 11: value getter with sync error
      - Input: ExecutionChain with error
      - Expected: Throws the error
    - [ ] case 12: then() with onfulfilled null for sync value
      - Input: ExecutionChain('test'), null
      - Expected: Same ExecutionChain
    - [ ] case 13: then() with onrejected null for sync error
      - Input: ExecutionChain with error, null, null
      - Expected: Same ExecutionChain
    - [ ] case 14: then() with onfulfilled provided but onrejected null for sync error
      - Input: ExecutionChain with error, () => 'fallback', null
      - Expected: Same ExecutionChain
    - [ ] case 15: then() with onrejected provided but onfulfilled null for sync value
      - Input: ExecutionChain('test'), null, () => 'error'
      - Expected: Same ExecutionChain
  - Edge Cases
    - [ ] case 1: then() without callbacks
      - Input: ExecutionChain('test'), null, null
      - Expected: Same ExecutionChain
    - [ ] case 2: then() with onfulfilled throwing error
      - Input: ExecutionChain('test'), () => { throw new Error('test') }
      - Expected: ExecutionChain with error
    - [ ] case 3: then() with onrejected throwing error
      - Input: ExecutionChain with error, null, () => { throw new Error('test') }
      - Expected: ExecutionChain with error
  - Error Cases
    - [ ] case 1: Constructor with both async value and sync error
      - Input: Promise.resolve('test'), new Error('test')
      - Expected: Throws Error
- `createExecutionChain`
  - Happy Path Cases
    - [ ] case 1: No arguments
      - Input: None
      - Expected: ExecutionChain<void>
    - [ ] case 2: With value
      - Input: 'test'
      - Expected: ExecutionChain<'test'>
