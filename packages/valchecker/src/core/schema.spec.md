# schema.spec.md

Source File: `./schema.ts`

## Functionality Summary
- Provides the core foundation for the validation schema system, including base classes, types, and utilities for implementing validation schemas that conform to the Standard Schema specification.

## Exported Items (Functions, Classes, Constants, TS Types, etc.)
- `DefineSchemaTypes`
  - Description: Type helper to define schema types with proper inference for async, transformed, meta, input, output, and issue code properties.
  - Input: Raw schema types parameter object
  - Output: Resolved schema types with proper inference
- `InferAsync`
  - Description: Type helper to infer if a schema is async
  - Input: Schema type
  - Output: Boolean indicating if schema operations are async
- `InferInput`
  - Description: Type helper to infer the input type of a schema
  - Input: Schema type
  - Output: The input type of the schema
- `InferIssueCode`
  - Description: Type helper to infer the issue codes a schema can produce
  - Input: Schema type
  - Output: Union of possible issue codes
- `InferIsValidReturn`
  - Description: Type helper to infer the return type of isValid method
  - Input: Schema type
  - Output: Promise<boolean> if async, boolean if sync
- `InferMeta`
  - Description: Type helper to infer the meta type of a schema
  - Input: Schema type
  - Output: The meta type of the schema
- `InferOutput`
  - Description: Type helper to infer the output type of a schema
  - Input: Schema type
  - Output: The output type of the schema
- `InferTransformed`
  - Description: Type helper to infer if a schema is transformed
  - Input: Schema type
  - Output: Boolean indicating if schema transforms input
- `InferValidateReturn`
  - Description: Type helper to infer the return type of validate method
  - Input: Schema type
  - Output: ValidationResult or Promise<ValidationResult>
- `SchemaMessage`
  - Description: Type for schema validation messages
  - Input: Schema types
  - Output: Message configuration type
- `SchemaTypes`
  - Description: Base schema types interface with async, transformed, meta, input, output, and issueCode properties
  - Input: N/A
  - Output: Schema types interface
- `UntransformedValSchema`
  - Description: Type for schemas that don't transform their input
  - Input: Input and Output types
  - Output: Schema type with transformed: false
- `ValidationFailureResult`
  - Description: Type for validation failure results containing issues array
  - Input: N/A
  - Output: Object with issues array
- `ValidationIssue`
  - Description: Type for individual validation issues with code, message, path, and error
  - Input: N/A
  - Output: Validation issue object type
- `ValidationResult`
  - Description: Union type for validation results (success or failure)
  - Input: Output type
  - Output: Success result or failure result
- `ValidationSuccessResult`
  - Description: Type for validation success results containing value
  - Input: Output type
  - Output: Object with value property
- `ValSchema`
  - Description: Type for general validation schemas
  - Input: Input and Output types
  - Output: Schema type with flexible properties
- `AbstractSchema`
  - Description: Abstract base class for all validation schemas, implements Standard Schema V1
  - Input: Schema types configuration
  - Output: Schema instance with validate and isValid methods
- `implementSchemaClass`
  - Description: Function to implement schema classes with validation logic
  - Input: Schema class constructor and implementation object
  - Output: N/A (mutates the class prototype)
- `isSuccessResult`
  - Description: Type guard to check if a validation result is successful
  - Input: Validation result
  - Output: Boolean indicating if result is success
- `prependIssuePath`
  - Description: Utility to prepend a path to validation issues
  - Input: Validation issue and path array
  - Output: New validation issue with prepended path

## Test Cases (as strictly required for 100% coverage)
- `AbstractSchema.validate`
  - Happy Path Cases
    - [ ] case 1: returns success result when validation succeeds
      - Input: `value: 'test'`, schema with successful validation
      - Expected: `{ value: 'test' }`
    - [ ] case 2: returns failure result when validation fails
      - Input: `value: 'invalid'`, schema with failing validation
      - Expected: `{ issues: [{ code: 'VALIDATION_ERROR' }] }`
    - [ ] case 3: handles async validation returning success
      - Input: `value: 'test'`, schema with async successful validation
      - Expected: `Promise<{ value: 'test' }>`
    - [ ] case 4: handles async validation returning failure
      - Input: `value: 'invalid'`, schema with async failing validation
      - Expected: `Promise<{ issues: [{ code: 'VALIDATION_ERROR' }] }>`
  - Edge Cases
    - [ ] case 1: handles validation throwing synchronous error
      - Input: `value: 'test'`, schema that throws error during validation
      - Expected: `{ issues: [{ code: 'UNKNOWN_ERROR', error: thrownError }] }`
    - [ ] case 2: handles async validation rejecting
      - Input: `value: 'test'`, schema with async validation that rejects
      - Expected: `Promise<{ issues: [{ code: 'UNKNOWN_ERROR', error: rejectionError }] }>`
    - [ ] case 3: handles custom message resolution
      - Input: `value: 'test'`, schema with custom message configuration
      - Expected: Result with custom error message
  - Error Cases (if applicable)
    - [ ] case 1: handles malformed validation result
      - Input: `value: 'test'`, schema returning invalid result format
      - Expected: `{ issues: [{ code: 'UNKNOWN_ERROR' }] }`
- `AbstractSchema.isValid`
  - Happy Path Cases
    - [ ] case 1: returns true for successful validation
      - Input: `value: 'test'`, schema with successful validation
      - Expected: `true`
    - [ ] case 2: returns false for failed validation
      - Input: `value: 'invalid'`, schema with failing validation
      - Expected: `false`
    - [ ] case 3: returns promise resolving to true for async success
      - Input: `value: 'test'`, schema with async successful validation
      - Expected: `Promise<true>`
    - [ ] case 4: returns promise resolving to false for async failure
      - Input: `value: 'invalid'`, schema with async failing validation
      - Expected: `Promise<false>`
- `implementSchemaClass`
  - Happy Path Cases
    - [ ] case 1: successfully implements schema class with validate function
      - Input: Schema class and implementation object with validate function
      - Expected: Class prototype has implementation methods
    - [ ] case 2: implements schema class with default message
      - Input: Schema class and implementation with defaultMessage
      - Expected: Schema instances use default message for issues
    - [ ] case 3: implements schema class with isTransformed function
      - Input: Schema class and implementation with isTransformed function
      - Expected: Schema isTransformed property works correctly
- `isSuccessResult`
  - Happy Path Cases
    - [ ] case 1: returns true for success result
      - Input: `{ value: 'test' }`
      - Expected: `true`
    - [ ] case 2: returns false for failure result
      - Input: `{ issues: [{ code: 'ERROR' }] }`
      - Expected: `false`
- `prependIssuePath`
  - Happy Path Cases
    - [ ] case 1: prepends path to issue without existing path
      - Input: `issue: { code: 'ERROR' }, path: ['root', 'field']`
      - Expected: `{ code: 'ERROR', path: ['root', 'field'] }`
    - [ ] case 2: prepends path to issue with existing path
      - Input: `issue: { code: 'ERROR', path: ['nested'] }, path: ['root']`
      - Expected: `{ code: 'ERROR', path: ['root', 'nested'] }`
